<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Logux Status</title>
    <style>
      body {
        font-family: sans-serif;
        margin: 2em;
      }
      article {
        max-width: 40em;
        margin: 0 auto;
      }
      img {
        float: right;
        margin: 0 0 2em 2em;
      }
      h1 {
        margin: 0 0 0.7em 0;
      }
      h2 {
        margin: 2em 0 0.5em 0;
      }
      p {
        margin: 0 0 1em 0;
      }
      section {
        width: 50%;
        float: left;
        padding: 1em 0;
      }
      .connection {
        width: 100%;
        font-size: 1.1em;
      }
      button {
        height: 2em;
        min-width: 14em;
        font-size: 1.1em;
      }
      footer {
        font-size: small;
        margin-top: 0.5em;
      }
    </style>
  </head>
  <body>
    <article>
      <img width="100" height="100" alt="Logux logo"
           src="https://cdn.rawgit.com/logux/logux/master/logo.svg" />
      <h1>Logux Status</h1>
      <p>
        <a href="https://github.com/logux">Logux</a>
        is a client-server communication tool.
        It synchronizes actions between clients and server logs.
      </p>
      <p>
        Provides UX best practices to report Logux synchronization status
        <a href="https://github.com/logux/logux-status">Logux Status</a>
        to user.
      </p>
      <p>
        This page tests Logux Status features:
      </p>
      <ul>
        <li>
          <strong>attention</strong> highlights tab on synchronization error
          to notify user.
        </li>
        <li>
          <strong>confirm</strong> shows confirm popup, when user close tab
          with non-synchronized actions.
        </li>
        <li>
          <strong>favicon</strong> changes favicon
          to show synchronization status.
        </li>
        <li>
          <strong>badge</strong> shows widget to display Logux
          synchronization status.
        </li>
        <li>
          <strong>log</strong> displays Logux events in browser console.
        </li>
      </ul>
      <h2>Controls</h2>
      <section class="connection">
        <label>
          <input type="checkbox" id="connection" checked />
          Client connected to server
          <small id="disabled" style="display: none">
            (disabled, because this tab is not in leader role)
          </small>
        </label>
        <footer>
          Tests:
          <strong>favicon</strong>,
          <strong>badge</strong>,
          <strong>log</strong>
        </footer>
      </section>
      <section>
        <button id="add">Add action to log</button>
        <footer>
          Tests:
          <strong>confirm</strong>,
          <strong>badge</strong>,
          <strong>log</strong>
        </footer>
      </section>
      <section>
        <button id="clean">Clean actions</button>
        <footer>
          Tests:
          <strong>log</strong>
        </footer>
      </section>
      <section>
        <button id="error">Error after 3 seconds</button>
        <footer>
          Tests:
          <strong>attention</strong>,
          <strong>badge</strong>,
          <strong>favicon</strong>
        </footer>
      </section>
      <section>
        <button id="denied">Denied after 3 seconds</button>
        <footer>
          Tests:
          <strong>attention</strong>,
          <strong>badge</strong>,
          <strong>favicon</strong>
        </footer>
      </section>
      <section>
        <button id="subprotocolError">Subprotocol error</button>
        <footer>
          Tests:
          <strong>attention</strong>,
          <strong>favicon</strong>,
          <strong>badge</strong>,
          <strong>log</strong>
        </footer>
      </section>
      <section>
        <button id="serverError">Server error after 3 seconds</button>
        <footer>
          Tests:
          <strong>attention</strong>,
          <strong>favicon</strong>,
          <strong>badge</strong>,
          <strong>log</strong>
        </footer>
      </section>
    </article>
  <script>!function(t){function e(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/",e(e.s=9)}([function(t,e,n){(t.exports=function(){this.events={}}).prototype={on:function(t,e){return t=this.events[t]=this.events[t]||[],t.push(e),function(){t.splice(t.indexOf(e)>>>0,1)}},emit:function(t){var e=this.events[t];if(e&&e[0]){var n=e.slice.call(arguments,1);e.slice().map(function(t){t.apply(this,n)})}}}},function(t,e){t.exports=function(t,e){t||(t={});for(var n in e)void 0===t[n]&&(t[n]=e[n]);return t}},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){function o(t,e){return t.lastAdded+=1,e[1].added=t.lastAdded,t.added.unshift(e),Promise.resolve(e[1])}function i(t,e){for(var n=0;n<t.length;n++){var o=t[n][1].id;if(e[0]===o[0]&&e[1]===o[1]&&e[2]===o[2])return n}return-1}function r(t){return void 0!==t}function s(){this.created=[],this.added=[],this.lastReceived=0,this.lastAdded=0,this.lastSent=0}var c=n(4);s.prototype={add:function(t,e){for(var n=[t,e],i=e.id,r=this.created,s=0;s<r.length;s++){var a=r[s],A=a[1].id;if(i[0]===A[0]&&i[1]===A[1]&&i[2]===A[2])return Promise.resolve(!1);if(c(a[1],e)>0)return r.splice(s,0,n),o(this,n)}return r.push(n),o(this,n)},byId:function(t){var e=i(this.created,t);if(-1===e)return Promise.resolve([null,null]);var n=this.created[e];return Promise.resolve([n[0],n[1]])},remove:function(t){var e=i(this.created,t);if(-1===e)return Promise.resolve(!1);var n=[this.created[e][0],this.created[e][1]];this.created.splice(e,1);for(var o=n[1].added,r=0,s=this.added.length-1;r<=s;){var c=s+r>>1,a=this.added[c][1].added;if(a>o)r=c+1;else{if(!(a<o)){this.added.splice(c,1);break}s=c-1}}return Promise.resolve(n)},get:function(t){var e;return e="created"===t.order?this.created:this.added,Promise.resolve({entries:e.slice(0)})},changeMeta:function(t,e){var n=i(this.created,t);if(-1===n)return Promise.resolve(!1);var o=this.created[n][1];for(var r in e)o[r]=e[r];return Promise.resolve(!0)},removeReason:function(t,e,n){var o=[];return this.created=this.created.filter(function(i){var s=i[1],a=e;if(-1===s.reasons.indexOf(t))return!0;if(r(a.olderThan)&&!c(s,a.olderThan))return!0;if(r(a.youngerThan)&&!c(a.youngerThan,s))return!0;if(r(a.minAdded)&&s.added<a.minAdded)return!0;if(r(a.maxAdded)&&s.added>a.maxAdded)return!0;var A=s.reasons;return A.splice(A.indexOf(t),1),0!==s.reasons.length||(n(i[0],s),o.push(s.added),!1)}),this.added=this.added.filter(function(t){return-1===o.indexOf(t[1].added)}),Promise.resolve()},getLastAdded:function(){return Promise.resolve(this.lastAdded)},getLastSynced:function(){return Promise.resolve({received:this.lastReceived,sent:this.lastSent})},setLastSynced:function(t){return void 0!==t.sent&&(this.lastSent=t.sent),void 0!==t.received&&(this.lastReceived=t.received),Promise.resolve()}},t.exports=s},function(t,e){function n(t,e){if(t&&!e)return!1;if(!t&&e)return!0;if(t.time>e.time)return!1;if(t.time<e.time)return!0;var n=t.id.slice(1).join("\t"),o=e.id.slice(1).join("\t");return!(n>o)&&(n<o||!(t.id[0]>e.id[0])&&t.id[0]<e.id[0])}t.exports=n},function(t,e,n){function o(t,e,n,o){o=r(o,s),i.call(this,t,e,n,o)}var i=n(6),r=n(1),s={fixTime:!0,timeout:2e4,ping:5e3};o.prototype={onConnect:function(){if(!this.connected){this.connected=!0;var t=this;this.initializing=this.initializing.then(function(){t.connected&&t.sendConnect()})}}},o.prototype=r(o.prototype,i.prototype),t.exports=o},function(t,e,n){function o(t,e,n){var o=n.added;void 0===o&&(o=t.lastSent),t.options.outMap?t.options.outMap(e,n).then(function(e){t.sendSync(o,[e])}):t.sendSync(o,[[e,n]])}function i(t,e,n,o){if(this.localNodeId=t,this.log=e,this.connection=n,this.options=o||{},this.options.ping&&!this.options.timeout)throw new Error("You must set timeout option to use ping");this.connected=!1,this.authenticated=!1,this.authenticating=!1,this.unauthenticated=[],this.timeFix=0,this.syncing=0,this.received={},this.lastSent=0,this.lastReceived=0,this.state="disconnected",this.emitter=new r,this.timeouts=[],this.throwsError=!0,this.unbind=[];var i=this;this.unbind.push(e.on("add",function(t,e){i.onAdd(t,e)})),this.unbind.push(n.on("connecting",function(){i.onConnecting()})),this.unbind.push(n.on("connect",function(){i.onConnect()})),this.unbind.push(n.on("message",function(t){i.onMessage(t)})),this.unbind.push(n.on("error",function(t){"Wrong message format"===t.message?i.sendError(new u(i,"wrong-format",t.received)):i.error(t),i.connection.disconnect("error")})),this.unbind.push(n.on("disconnect",function(){i.onDisconnect()})),this.initialized=!1,this.lastAddedCache=0,this.initializing=this.initialize()}var r=n(0),s=n(13),c=n(14),a=n(15),A=n(16),d=n(17),u=n(7),h=[c,s,a,A,d],g=["connect","connected","error"];i.prototype={remoteNodeId:void 0,localProtocol:2,minProtocol:2,remoteProtocol:void 0,remoteSubprotocol:void 0,on:function(t,e){return this.emitter.on(t,e)},catch:function(t){this.throwsError=!1,this.on("error",t)},waitFor:function(t){if(this.state===t)return Promise.resolve();var e=this;return new Promise(function(n){var o=e.on("state",function(){e.state===t&&(o(),n())})})},destroy:function(){this.connection.destroy?this.connection.destroy():this.connected&&this.connection.disconnect("destroy");for(var t=0;t<this.unbind.length;t++)this.unbind[t]()},send:function(t){this.connected&&(this.delayPing(),this.connection.send(t))},onConnecting:function(){this.setState("connecting")},onConnect:function(){this.delayPing(),this.connected=!0},onDisconnect:function(){for(;this.timeouts.length>0;)this.endTimeout();this.pingTimeout&&clearTimeout(this.pingTimeout),this.connected=!1,this.setState("disconnected")},onMessage:function(t){this.delayPing();var e=t[0];if(!this.authenticated&&-1===g.indexOf(e))return void(this.authenticating?this.unauthenticated.push(t):this.sendError(new u(this,"missed-auth",JSON.stringify(t))));for(var n=new Array(t.length-1),o=1;o<t.length;o++)n[o-1]=t[o];this[e+"Message"].apply(this,n)},onAdd:function(t,e){if(this.connected){if(this.lastAddedCache<e.added&&(this.lastAddedCache=e.added),this.received[e.id.join("\t")])return void delete this.received[e.id.join("\t")];if(this.options.outFilter){var n=this;this.options.outFilter(t,e).then(function(i){i&&o(n,t,e)})}else o(this,t,e)}},syncError:function(t,e,n){var o=new u(this,t,e,n);this.error(o)},error:function(t){if(this.emitter.emit("error",t),this.throwsError)throw t},setState:function(t){this.state!==t&&(this.state=t,this.emitter.emit("state"))},startTimeout:function(){if(this.options.timeout){var t=this.options.timeout,e=this,n=setTimeout(function(){e.connected&&e.connection.disconnect("timeout"),e.syncError("timeout",t)},t);this.timeouts.push(n)}},endTimeout:function(){this.timeouts.length>0&&clearTimeout(this.timeouts.shift())},delayPing:function(){if(this.options.ping){this.pingTimeout&&clearTimeout(this.pingTimeout);var t=this;this.pingTimeout=setTimeout(function(){t.connected&&t.authenticated&&t.sendPing()},this.options.ping)}},syncSinceQuery:function(t){var e=this,n=[];return this.log.each({order:"added"},function(o,i){return!(i.added<=t)&&(e.options.outFilter?n.push(e.options.outFilter(o,i).then(function(t){return!!t&&[o,i]})):n.push(Promise.resolve([o,i])),!0)}).then(function(){return Promise.all(n)}).then(function(t){var e={added:0};return e.entries=t.filter(function(t){return t&&e.added<t[1].added&&(e.added=t[1].added),!1!==t}),e})},syncSince:function(t){var e=this;this.syncSinceQuery(t).then(function(t){e.connected&&(t.entries.length>0?e.options.outMap?Promise.all(t.entries.map(function(t){return e.options.outMap(t[0],t[1])})).then(function(n){e.sendSync(t.added,n)}):e.sendSync(t.added,t.entries):e.setState("synchronized"))})},setLastSent:function(t){this.lastSent<t&&(this.lastSent=t),this.log.store.setLastSynced({sent:t})},setLastReceived:function(t){this.lastReceived<t&&(this.lastReceived=t),this.log.store.setLastSynced({received:t})},now:function(){return Date.now()},initialize:function(){var t=this;return Promise.all([this.log.store.getLastSynced(),this.log.store.getLastAdded()]).then(function(e){t.initialized=!0,t.lastSent=e[0].sent,t.lastReceived=e[0].received,t.lastAddedCache=e[1],t.connection.connected&&t.onConnect()})},sendDuilian:function(){this.send(["duilian",Object.keys(p)[0]])},duilianMessage:function(t){p[t]&&this.send(["duilian",p[t]])}};for(var l=0;l<=h.length;l++){var f=h[l];for(var m in f)i.prototype[m]=f[m]}var p={"金木水火土":"板城烧锅酒"};t.exports=i},function(t,e){function n(t,e,o,i){Error.call(this,e),this.name="SyncError",this.type=e,this.options=o,this.description=n.describe(e,o),this.sync=t,this.received=!!i,this.message="",i?(this.sync.remoteNodeId?this.message+=this.sync.remoteNodeId+" sent ":this.message+="Logux received ",this.message+=this.type+" error",this.description!==this.type&&(this.message+=" ("+this.description+")")):this.message=this.description,Error.captureStackTrace&&Error.captureStackTrace(this,n)}n.describe=function(t,e){return"timeout"===t?"A timeout was reached ("+e+"ms)":"wrong-format"===t?"Wrong message format in "+e:"unknown-message"===t?"Unknown message `"+e+"` type":"missed-auth"===t?"Start authentication before sending message "+e:"wrong-protocol"===t?"Logux supports protocols only from version "+e.supported+", but you use "+e.used:"wrong-subprotocol"===t?"Only "+e.supported+" application subprotocols are supported, but you use "+e.used:"wrong-credentials"===t?"Wrong credentials":t},n.prototype=Error.prototype,t.exports=n},function(t,e,n){function o(t){if(t||(t={}),void 0===t.nodeId)throw new Error("Expected node ID");if("object"!=typeof t.store)throw new Error("Expected store");this.nodeId=t.nodeId,this.lastTime=0,this.sequence=0,this.store=t.store,this.emitter=new i}var i=n(0);o.prototype={on:function(t,e){return this.emitter.on(t,e)},add:function(t,e){if(void 0===t.type)throw new Error('Expected "type" in action');e||(e={});var n=!1;void 0===e.id&&(n=!0,e.id=this.generateId()),void 0===e.time&&(e.time=e.id[0]),void 0===e.reasons?e.reasons=[]:Array.isArray(e.reasons)||(e.reasons=[e.reasons]),e.reasons.forEach(function(t){if("string"!=typeof t)throw new Error('Expected "reasons" to be strings')}),e.keepLast&&(this.removeReason(e.keepLast,{olderThan:e}),e.reasons.push(e.keepLast));var o=this;return this.emitter.emit("preadd",t,e),0===e.reasons.length&&n?(this.emitter.emit("add",t,e),this.emitter.emit("clean",t,e),Promise.resolve(e)):0===e.reasons.length?this.store.byId(e.id).then(function(n){return!n[0]&&(o.emitter.emit("add",t,e),o.emitter.emit("clean",t,e),e)}):this.store.add(t,e).then(function(e){return!1!==e&&(o.emitter.emit("add",t,e),e)})},generateId:function(){var t=Date.now();return t<=this.lastTime?(t=this.lastTime,this.sequence+=1):(this.lastTime=t,this.sequence=0),[t,this.nodeId,this.sequence]},each:function(t,e){e||(e=t,t={order:"created"});var n=this.store;return new Promise(function(o){function i(t){t().then(function(t){for(var n,r=0;r<t.entries.length;r++){var s=t.entries[r];if(!1===(n=e(s[0],s[1])))break}!1!==n&&t.next?i(t.next):o()})}i(n.get.bind(n,t))})},changeMeta:function(t,e){var n;for(n in e)if("id"===n||"added"===n||"time"===n)throw new Error('Meta "'+n+'" is read-only');var o=this.emitter;return e.reasons&&0===e.reasons.length?this.store.remove(t).then(function(t){if(t){for(n in e)t[1][n]=e[n];o.emit("clean",t[0],t[1])}return!!t}):this.store.changeMeta(t,e)},removeReason:function(t,e){e||(e={});var n=this;return this.store.removeReason(t,e,function(t,e){n.emitter.emit("clean",t,e)})},byId:function(t){return this.store.byId(t)}},t.exports=o},function(t,e,n){var o=n(10),i=n(3),r=n(5),s=n(24),c=n(6),a=n(8),A=n(25),d=n(26),u=n(27),h=n(28),g=n(30),l=n(32),f=n(33),m=n(38),p=n(39),v=n(40),y=new s(500);new c("server",new a({store:new i,nodeId:"server"}),y.right);var I=new o({subprotocol:"1.0.0",server:"wss://example.com/",userId:10}),D=new r(I.sync.localNodeId,I.log,y.left);D.connection.url="wss://example.com/",D.emitter=I.sync.emitter,I.sync=D,A(I),d(I),u(I,{normal:m,offline:p,error:v}),h(I,{messages:l,styles:f}),g(I),I.on("role",function(){var t="leader"===I.role;document.all.connection.disabled=!t,document.all.disabled.style.display=t?"none":"inline"}),I.start(),document.all.connection.onchange=function(t){t.target.checked?I.sync.connection.connect():I.sync.connection.disconnect()},document.all.error.onclick=function(){setTimeout(function(){I.log.add({type:"logux/undo",reason:"error"})},3e3)},document.all.denied.onclick=function(){setTimeout(function(){I.log.add({type:"logux/undo",reason:"denied"})},3e3)},document.all.serverError.onclick=function(){setTimeout(function(){y.right.send(["error","wrong-format"])},3e3)},document.all.subprotocolError.onclick=function(){I.sync.syncError("wrong-subprotocol",{supported:"2.x",used:"1.0.0"})},document.all.add.onclick=function(){I.log.add({type:"TEST"},{sync:!0,reasons:["test"]})},document.all.clean.onclick=function(){I.log.removeReason("test")}},function(t,e,n){function o(t,e){return t.options.prefix+":"+t.options.userId+":"+e}function i(t,e,n){t.isLocalStorage&&localStorage.setItem(o(t,e),JSON.stringify(n))}function r(t){var e=localStorage.getItem(o(t,"leader")),n=[];return"string"==typeof e&&(n=JSON.parse(e)),n}function s(t){i(t,"leader",[t.id,Date.now()])}function c(t){"disconnected"!==t.state&&h(t,"disconnected"),u(t)}function a(t){clearTimeout(t.watching),t.watching=setTimeout(function(){d(t)?a(t):c(t)},t.roleTimeout)}function A(t,e){if(t.role!==e){var n=t.sync;if(t.role=e,clearTimeout(t.watching),"leader"===e?(localStorage.removeItem(o(t,"state")),t.leadership=setInterval(function(){t.unloading||s(t)},t.leaderPing),n.connection.connect()):(clearTimeout(t.elections),clearInterval(t.leadership),"disconnected"!==n.state&&t.sync.connection.disconnect()),"follower"===e){var i="disconnected",r=localStorage.getItem(o(t,"state"));r&&null!==r&&(i=JSON.parse(r)),i!==t.state&&(t.state=i,t.emitter.emit("state"))}t.emitter.emit("role")}}function d(t){var e=r(t);return e[1]&&e[1]>=Date.now()-t.leaderTimeout}function u(t){s(t),A(t,"candidate"),t.elections=setTimeout(function(){r(t,"leader")[0]===t.id?A(t,"leader"):(A(t,"follower"),a(t))},t.electionDelay)}function h(t,e){t.state=e,t.emitter.emit("state"),i(t,"state",t.state)}function g(t){f.call(this,t),this.role="candidate",this.roleTimeout=3e3+Math.floor(1e3*Math.random()),this.leaderTimeout=5e3,this.leaderPing=2e3,this.electionDelay=1e3,this.state=this.sync.state;var e=this;this.sync.on("state",function(){"leader"===e.role&&h(e,e.sync.state)}),this.log.on("add",function(t,n){e.emitter.emit("add",t,n),n.tab!==e.id&&i(e,"add",[e.id,t,n])}),this.log.on("clean",function(t,n){e.emitter.emit("clean",t,n),n.tab!==e.id&&i(e,"clean",[e.id,t,n])}),this.onStorage=this.onStorage.bind(this),this.onUnload=this.onUnload.bind(this),window.addEventListener("storage",this.onStorage),window.addEventListener("unload",this.onUnload)}var l=n(1),f=n(11);g.prototype={start:function(){if(this.cleanPrevActions(),!this.isLocalStorage)return this.role="leader",this.emitter.emit("role"),void this.sync.connection.connect();d(this)?(A(this,"follower"),a(this)):u(this)},destroy:function(){f.prototype.destroy.call(this),clearTimeout(this.watching),clearTimeout(this.elections),clearInterval(this.leadership),window.removeEventListener("storage",this.onStorage)},clean:function(){return this.isLocalStorage&&(localStorage.removeItem(o(this,"add")),localStorage.removeItem(o(this,"clean")),localStorage.removeItem(o(this,"state")),localStorage.removeItem(o(this,"leader"))),f.prototype.clean.call(this)},on:function(t,e){return this.emitter.on(t,e)},onStorage:function(t){if(null!==t.newValue){var e;if(t.key===o(this,"add"))e=JSON.parse(t.newValue),e[0]!==this.id&&(e[2].tab&&e[2].tab!==this.id||(this.emitter.emit("add",e[1],e[2]),"leader"===this.role&&this.sync.onAdd(e[1],e[2])));else if(t.key===o(this,"clean"))e=JSON.parse(t.newValue),e[0]!==this.id&&(e[2].tab&&e[2].tab!==this.id||this.emitter.emit("clean",e[1],e[2]));else if(t.key===o(this,"leader"))e=JSON.parse(t.newValue),0===e.length?c(this):e[0]!==this.id&&"candidate"!==this.role&&(A(this,"follower"),a(this));else if(t.key===o(this,"state")){var n=JSON.parse(localStorage.getItem(t.key));this.state!==n&&(this.state=n,this.emitter.emit("state"))}}},onUnload:function(){"leader"===this.role&&(this.unloading=!0,i(this,"leader",[])),f.prototype.onUnload.call(this)}},g.prototype=l(g.prototype,f.prototype),Object.defineProperty(g.prototype,"connected",{get:function(){return"disconnected"!==this.state&&"connecting"!==this.state}}),t.exports=g},function(t,e,n){(function(e){function o(t){localStorage.setItem(t.options.prefix+":tab:"+t.id,Date.now())}function i(t,e){t.log.removeReason("tab"+e).then(function(){t.isLocalStorage&&localStorage.removeItem(t.options.prefix+":tab:"+e)})}function r(t){var e={};for(var n in t)"type"===n?e.type="logux/subscribe":e[n]=t[n];return e}function s(t){function n(t,e){var n,o=t.type;if("logux/subscribe"===o){n=JSON.stringify(t);y.subscriptions.some(function(e){return e.channel===t.channel&&JSON.stringify(e)===n})||y.subscriptions.push(t)}else"logux/unsubscribe"===o&&(n=JSON.stringify(r(t)),y.subscriptions=y.subscriptions.filter(function(e){return e.channel!==t.channel&&JSON.stringify(e)!==n}))}function i(t,e){var n=e.id[1].split(":")[0];return Promise.resolve(!!e.sync&&n===y.options.userId)}function s(t,e){var n={};for(var o in e)-1!==f.indexOf(o)&&(n[o]=e[o]),e.subprotocol&&e.subprotocol!==y.options.subprotocol&&(n.subprotocol=e.subprotocol);return Promise.resolve([t,n])}if(this.options=t||{},void 0===this.options.prefix&&(this.options.prefix="logux"),this.id=h(8),this.options.userId=this.options.userId.toString(),this.isLocalStorage=!1,"undefined"!=typeof localStorage)try{localStorage.setItem(this.id,"1"),localStorage.removeItem(this.id),this.isLocalStorage=!0}catch(t){}this.nodeId=this.options.userId+":"+this.id;var m;/^ws:\/\//.test(this.options.server)&&!t.allowDangerousProtocol&&(m=function(t){return"object"!=typeof t||"development"!==t.env?(console.error("Without SSL, old proxies blocks WebSockets. Use WSS for Logux or set allowDangerousProtocol option."),Promise.resolve(!1)):Promise.resolve(!0)});var p=this.options.store;p||(p=e.indexedDB?new l(this.options.prefix+":"+this.options.userId):new a);var v;v=this.options.time?this.options.time.nextLog({store:p,nodeId:this.nodeId}):new g({store:p,nodeId:this.nodeId}),this.log=v;var y=this;v.on("preadd",function(t,e){e.id[1]!==y.nodeId||e.subprotocol||(e.subprotocol=y.options.subprotocol)}),this.subscriptions=[],this.emitter=new d,this.on?this.on("add",n):v.on("add",n),this.tabPing=6e4,this.tabTimeout=10*this.tabPing;var I="tab"+y.id;if(this.isLocalStorage)var D=v.on("add",function(t,e){-1!==e.reasons.indexOf(I)&&(o(y),y.pinging=setInterval(function(){o(y)},y.tabPing),D())});var b;if("string"==typeof this.options.server){var w=new c(this.options.server);b=new u(w,{minDelay:this.options.minDelay,maxDelay:this.options.maxDelay,attempts:this.options.attempts})}else b=this.options.server;this.sync=new A(this.nodeId,this.log,b,{credentials:this.options.credentials,subprotocol:this.options.subprotocol,outFilter:i,timeout:this.options.timeout,outMap:s,ping:this.options.ping,auth:m}),this.sync.on("debug",function(t,e){"error"===t&&console.error("Error on Logux server:\n",e)}),this.sync.on("connect",function(){for(var t in y.subscriptions)y.log.add(y.subscriptions[t],{sync:!0})}),this.onUnload=this.onUnload.bind(this),window.addEventListener("unload",this.onUnload)}var c=n(12),a=n(3),A=n(5),d=n(0),u=n(18),h=n(19),g=n(8),l=n(21),f=["id","time","nodeIds","users","channels"];s.prototype={start:function(){this.cleanPrevActions(),this.sync.connection.connect()},destroy:function(){this.onUnload(),this.sync.destroy(),clearInterval(this.pinging),window.removeEventListener("unload",this.onUnload)},clean:function(){return this.destroy(),this.log.store.clean?this.log.store.clean():Promise.resolve()},cleanPrevActions:function(){if(this.isLocalStorage)for(var t in localStorage){var e=this.options.prefix+":tab:";if(t.slice(0,e.length)===e){var n=parseInt(localStorage.getItem(t));Date.now()-n>this.tabTimeout&&i(this,t.slice(e.length))}}},onUnload:function(){this.pinging&&i(this,this.id)}},t.exports=s}).call(e,n(2))},function(t,e,n){function o(t){this.connected=!1,this.emitter=new i,this.url=t}var i=n(0);o.prototype={connect:function(){if(!window.WebSocket)throw new Error("Browser has no WebSocket support");this.emitter.emit("connecting"),this.ws=new window.WebSocket(this.url);var t=this;return this.ws.onclose=function(){t.connected=!1,t.emitter.emit("disconnect")},this.ws.onmessage=function(e){var n;try{n=JSON.parse(e.data)}catch(n){return void t.error(e.data)}t.emitter.emit("message",n)},new Promise(function(e){t.ws.onopen=function(){t.connected=!0,t.emitter.emit("connect"),e()}})},disconnect:function(){this.ws&&(this.ws.close(),this.ws.onclose(),this.ws=void 0)},on:function(t,e){return this.emitter.on(t,e)},send:function(t){if(!this.ws)throw new Error("Start a connection before send a message");this.ws.send(JSON.stringify(t))},error:function(t){var e=new Error("Wrong message format");e.received=t,this.emitter.emit("error",e)}},t.exports=o},function(t,e,n){function o(t,e,n,o){if(!t.options.auth)return t.authenticated=!0,void o();t.authenticating=!0,t.options.auth(n,e).then(function(e){if(e){t.authenticated=!0,t.authenticating=!1,o();for(var n=0;n<t.unauthenticated.length;n++)t.onMessage(t.unauthenticated[n]);t.unauthenticated=[]}else t.sendError(new s(t,"wrong-credentials")),t.destroy()})}function i(t,e){return t.remoteProtocol=e,e>=t.minProtocol||(t.sendError(new s(t,"wrong-protocol",{supported:t.minProtocol,used:e})),t.destroy(),!1)}function r(t){try{t.emitter.emit("connect")}catch(e){if("SyncError"===e.name)return t.sendError(e),!1;throw e}return!0}var s=n(7);t.exports={sendConnect:function(){var t=["connect",this.localProtocol,this.localNodeId,this.lastReceived],e={};this.options.credentials&&(e.credentials=this.options.credentials),this.options.subprotocol&&(e.subprotocol=this.options.subprotocol),Object.keys(e).length>0&&t.push(e),this.options.fixTime&&(this.connectSended=this.now()),this.startTimeout(),this.send(t)},sendConnected:function(t,e){this.baseTime=e;var n=["connected",this.localProtocol,this.localNodeId,[t,e]],o={};this.options.credentials&&(o.credentials=this.options.credentials),this.options.subprotocol&&(o.subprotocol=this.options.subprotocol),Object.keys(o).length>0&&n.push(o),this.send(n)},connectMessage:function(t,e,n,s){var c=this.now();if(s||(s={}),this.remoteNodeId=e,i(this,t)){if(this.remoteSubprotocol=s.subprotocol||"0.0.0",!r(this))return void this.destroy();var a=this;o(this,e,s.credentials,function(){a.sendConnected(c,a.now()),a.syncSince(n)})}},connectedMessage:function(t,e,n,s){if(s||(s={}),this.endTimeout(),this.remoteNodeId=e,i(this,t)){if(this.baseTime=n[1],this.options.fixTime){var c=this.now(),a=n[1]-n[0],A=c-this.connectSended-a;this.timeFix=Math.floor(this.connectSended-n[0]+A/2)}if(this.remoteSubprotocol=s.subprotocol||"0.0.0",!r(this))return void this.destroy();var d=this;o(this,e,s.credentials,function(){d.syncSince(d.lastSent)})}}}},function(t,e){t.exports={sendError:function(t){var e=["error",t.type];void 0!==t.options&&e.push(t.options),this.send(e),this.emitter.emit("clientError",t)},errorMessage:function(t,e){this.syncError(t,e,!0)}}},function(t,e){t.exports={sendPing:function(){this.startTimeout(),this.send(["ping",this.lastAddedCache]),this.pingTimeout&&clearTimeout(this.pingTimeout)},pingMessage:function(t){this.setLastReceived(t),this.send(["pong",this.lastAddedCache])},pongMessage:function(t){this.setLastReceived(t),this.endTimeout()}}},function(t,e){t.exports={sendSync:function(t,e){this.startTimeout();for(var n=[],o=0;o<e.length;o++){var i=e[o][1],r={};for(var s in i)"added"!==s&&(r[s]=i[s]);this.timeFix&&(r.time-=this.timeFix),r.id[0]-=this.baseTime,r.time-=this.baseTime,r.id[1]===this.localNodeId&&(0===r.id[2]?r.id=r.id[0]:r.id=[r.id[0],r.id[2]]),n.push(e[o][0],r)}this.syncing+=1,this.setState("sending"),this.send(["sync",t].concat(n))},sendSynced:function(t){this.send(["synced",t])},syncMessage:function(t){for(var e=this,n=[],o=1;o<arguments.length-1;o+=2){var i=arguments[o],r=arguments[o+1];"number"==typeof r.id?r.id=[r.id,this.remoteNodeId,0]:2===r.id.length&&(r.id=[r.id[0],this.remoteNodeId,r.id[1]]),r.id[0]=r.id[0]+this.baseTime,r.time=r.time+this.baseTime;var s=Promise.resolve([i,r]);this.options.inFilter&&(s=s.then(function(t){return e.options.inFilter(t[0],t[1]).then(function(e){return!!e&&t})})),s.then(function(t){return!!t&&(e.timeFix&&(t[1].time=t[1].time+e.timeFix),e.options.inMap?e.options.inMap(t[0],t[1]):t)}).then(function(t){return!!t&&(e.received[t[1].id.join("\t")]=!0,e.log.add(t[0],t[1]))}),n.push(s)}Promise.all(n).then(function(){e.setLastReceived(t),e.sendSynced(t)})},syncedMessage:function(t){this.endTimeout(),this.setLastSent(t),this.syncing>0&&(this.syncing-=1),0===this.syncing&&this.setState("synchronized")}}},function(t,e){t.exports={sendDebug:function(t,e){this.send(["debug",t,e])},debugMessage:function(t,e){this.emitter.emit("debug",t,e)}}},function(t,e,n){function o(t,e){function n(){!c.reconnecting||c.connected||c.connecting||document.hidden||c.connect()}function o(){!c.reconnecting||c.connected||c.connecting||navigator.onLine&&c.connect()}this.connection=t,this.options=i(e,r),this.reconnecting=t.connected,this.connecting=!1,this.attempts=0,this.unbind=[];var c=this;this.unbind.push(this.connection.on("message",function(t){"error"===t[0]&&-1!==s.indexOf(t[1])&&(c.reconnecting=!1)})),this.unbind.push(this.connection.on("connecting",function(){c.connecting=!0})),this.unbind.push(this.connection.on("connect",function(){c.attempts=0,c.connecting=!1})),this.unbind.push(this.connection.on("disconnect",function(){c.connecting=!1,c.reconnecting&&c.reconnect()})),this.unbind.push(function(){clearTimeout(c.timer)}),"undefined"!=typeof document&&(document.addEventListener("visibilitychange",n,!1),window.addEventListener("online",o,!1),this.unbind.push(function(){document.removeEventListener("visibilitychange",n,!1),window.removeEventListener("online",o,!1)}))}var i=n(1),r={minDelay:1e3,maxDelay:5e3,attempts:1/0},s=["wrong-protocol","wrong-subprotocol","wrong-credentials"];o.prototype={connect:function(){return this.attempts+=1,this.reconnecting=!0,this.connection.connect()},disconnect:function(t){return"timeout"!==t&&(this.reconnecting=!1),this.connection.disconnect(t)},destroy:function(){for(var t=0;t<this.unbind.length;t++)this.unbind[t]();this.disconnect("destroy")},reconnect:function(){if(this.attempts>this.options.attempts-1)return this.reconnecting=!1,void(this.attempts=0);var t=this.nextDelay(),e=this;this.timer=setTimeout(function(){!e.reconnecting||e.connecting||e.connected||e.connect()},t)},send:function(){return this.connection.send.apply(this.connection,arguments)},on:function(){return this.connection.on.apply(this.connection,arguments)},nextDelay:function(){var t=this.options.minDelay*Math.pow(2,this.attempts),e=Math.random(),n=Math.floor(.5*e*t);return 1===Math.floor(10*e)&&(n=-n),Math.min(t+n,this.options.maxDelay)||0}},Object.defineProperty(o.prototype,"connected",{get:function(){return this.connection.connected}}),t.exports=o},function(t,e,n){var o=n(20);t.exports=function(t){t=t||21;for(var e="",n=o(t);0<t--;)e+="_~0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[63&n[t]];return e}},function(t,e){var n=window.crypto||window.msCrypto;t.exports=function(t){return n.getRandomValues(new Uint8Array(t))}},function(t,e,n){(function(e){function o(t,e){t.onerror=function(t){e(t.target.error)}}function i(t){return new A(function(e,n){o(t,n),t.onsuccess=function(t){e(t.target.result)}})}function r(t){return function(e){return e?(e.value.meta.added=e.value.added,{entries:[[e.value.action,e.value.meta]],next:function(){return e.continue(),i(t).then(r(t))}}):{entries:[]}}}function s(t){return void 0!==t}function c(t){this.name=t||"logux",this.adding={}}var a=n(4),A=n(22);A.prototype.catch=function(t){return this.then(null,t)};c.prototype={init:function(){if(this.initing)return this.initing;var t=this,n=indexedDB.open(this.name,1);return n.onupgradeneeded=function(t){var e=t.target.result,n=e.createObjectStore("log",{keyPath:"added",autoIncrement:!0});n.createIndex("id","id",{unique:!0}),n.createIndex("created","created",{unique:!0}),n.createIndex("reasons","reasons",{multiEntry:!0}),e.createObjectStore("extra",{keyPath:"key"}).transaction.oncomplete=function(){e.transaction("extra","readwrite").objectStore("extra").add({key:"lastSynced",sent:0,received:0})}},this.initing=i(n).then(function(n){return t.db=n,n.onversionchange=function(){t.db.close(),e.document&&e.document.reload&&e.document.reload()},t}),this.initing},get:function(t){var e;return this.init().then(function(n){var o=n.os("log");return e="created"===t.order?o.index("created").openCursor(null,"prev"):o.openCursor(null,"prev"),i(e).then(r(e))})},byId:function(t){return this.init().then(function(e){return i(e.os("log").index("id").get(t))}).then(function(t){return t?[t.action,t.meta]:[null,null]})},remove:function(t){return this.init().then(function(e){var n=e.os("log","write");return i(n.index("id").get(t)).then(function(t){return!!t&&i(n.delete(t.added)).then(function(){return t.meta.added=t.added,[t.action,t.meta]})})})},add:function(t,e){var n={id:e.id,meta:e,time:e.time,action:t,reasons:e.reasons,created:[e.time,e.id[1],e.id[2],e.id[0]].join("\t")};return this.adding[n.created]?new A(function(t){t(!1)}):(this.adding[n.created]=!0,this.init().then(function(t){var o=t.os("log","write");return i(o.index("id").get(e.id)).then(function(r){return!r&&i(o.add(n)).then(function(o){return delete t.adding[n.created],e.added=o,e})})}))},changeMeta:function(t,e){return this.init().then(function(n){var o=n.os("log","write");return i(o.index("id").get(t)).then(function(t){if(t){for(var n in e)t.meta[n]=e[n];return e.reasons&&(t.reasons=e.reasons),i(o.put(t)).then(function(){return!0})}return!1})})},removeReason:function(t,e,n){return this.init().then(function(i){var r=i.os("log","write"),c=r.index("reasons").openCursor(t);return new A(function(i,A){o(c,A),c.onsuccess=function(c){if(!c.target.result)return void i();var d=c.target.result.value,u=d.meta,h=e;if(s(h.olderThan)&&!a(u,h.olderThan))return void c.target.result.continue();if(s(h.youngerThan)&&!a(h.youngerThan,u))return void c.target.result.continue();if(s(h.minAdded)&&d.added<h.minAdded)return void c.target.result.continue();if(s(h.maxAdded)&&d.added>h.maxAdded)return void c.target.result.continue();var g;1===d.reasons.length?(d.meta.reasons=[],d.meta.added=d.added,n(d.action,d.meta),g=r.delete(d.added)):(d.reasons.splice(d.reasons.indexOf(t),1),d.meta.reasons=d.reasons,g=r.put(d)),o(g,A),g.onsuccess=function(){c.target.result.continue()}}})})},getLastAdded:function(){return this.init().then(function(t){return i(t.os("log").openCursor(null,"prev"))}).then(function(t){return t?t.value.added:0})},getLastSynced:function(){return this.init().then(function(t){return i(t.os("extra").get("lastSynced"))}).then(function(t){return{sent:t.sent,received:t.received}})},setLastSynced:function(t){return this.init().then(function(e){var n=e.os("extra","write");return i(n.get("lastSynced")).then(function(e){return void 0!==t.sent&&(e.sent=t.sent),void 0!==t.received&&(e.received=t.received),i(n.put(e))})})},os:function(t,e){var n=e?"readwrite":"readonly";return this.db.transaction(t,n).objectStore(t)},clean:function(){return this.init().then(function(t){return t.db.close(),i(e.indexedDB.deleteDatabase(t.name))})}},t.exports=c}).call(e,n(2))},function(t,e,n){"use strict";function o(){}function i(t){try{return t.then}catch(t){return p=t,v}}function r(t,e){try{return t(e)}catch(t){return p=t,v}}function s(t,e,n){try{t(e,n)}catch(t){return p=t,v}}function c(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("Promise constructor's argument is not a function");this._75=0,this._83=0,this._18=null,this._38=null,t!==o&&f(t,this)}function a(t,e,n){return new t.constructor(function(i,r){var s=new c(o);s.then(i,r),A(t,new l(e,n,s))})}function A(t,e){for(;3===t._83;)t=t._18;if(c._47&&c._47(t),0===t._83)return 0===t._75?(t._75=1,void(t._38=e)):1===t._75?(t._75=2,void(t._38=[t._38,e])):void t._38.push(e);d(t,e)}function d(t,e){m(function(){var n=1===t._83?e.onFulfilled:e.onRejected;if(null===n)return void(1===t._83?u(e.promise,t._18):h(e.promise,t._18));var o=r(n,t._18);o===v?h(e.promise,p):u(e.promise,o)})}function u(t,e){if(e===t)return h(t,new TypeError("A promise cannot be resolved with itself."));if(e&&("object"==typeof e||"function"==typeof e)){var n=i(e);if(n===v)return h(t,p);if(n===t.then&&e instanceof c)return t._83=3,t._18=e,void g(t);if("function"==typeof n)return void f(n.bind(e),t)}t._83=1,t._18=e,g(t)}function h(t,e){t._83=2,t._18=e,c._71&&c._71(t,e),g(t)}function g(t){if(1===t._75&&(A(t,t._38),t._38=null),2===t._75){for(var e=0;e<t._38.length;e++)A(t,t._38[e]);t._38=null}}function l(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function f(t,e){var n=!1,o=s(t,function(t){n||(n=!0,u(e,t))},function(t){n||(n=!0,h(e,t))});n||o!==v||(n=!0,h(e,p))}var m=n(23),p=null,v={};t.exports=c,c._47=null,c._71=null,c._44=o,c.prototype.then=function(t,e){if(this.constructor!==c)return a(this,t,e);var n=new c(o);return A(this,new l(t,e,n)),n}},function(t,e,n){"use strict";(function(e){function n(t){s.length||(r(),c=!0),s[s.length]=t}function o(){for(;a<s.length;){var t=a;if(a+=1,s[t].call(),a>A){for(var e=0,n=s.length-a;e<n;e++)s[e]=s[e+a];s.length-=a,a=0}}s.length=0,a=0,c=!1}function i(t){return function(){function e(){clearTimeout(n),clearInterval(o),t()}var n=setTimeout(e,0),o=setInterval(e,50)}}t.exports=n;var r,s=[],c=!1,a=0,A=1024,d=void 0!==e?e:self,u=d.MutationObserver||d.WebKitMutationObserver;r="function"==typeof u?function(t){var e=1,n=new u(t),o=document.createTextNode("");return n.observe(o,{characterData:!0}),function(){e=-e,o.data=e}}(o):i(o),n.requestFlush=r,n.makeRequestCallFromTimer=i}).call(e,n(2))},function(t,e,n){function o(t,e){this.connected=!1,this.emitter=new r,this.type=e,this.pair=t}function i(t){this.delay=t||1,this.left=new o(this,"left"),this.right=new o(this,"right")}var r=n(0);o.prototype={other:function(){return"left"===this.type?this.pair.right:this.pair.left},on:function(t,e){return this.emitter.on(t,e)},connect:function(){if(this.connected)throw new Error("Connection already established");this.emitter.emit("connecting");var t=this;return new Promise(function(e){setTimeout(function(){t.other().connected=!0,t.connected=!0,t.other().emitter.emit("connect"),t.emitter.emit("connect"),e()},t.pair.delay)})},disconnect:function(t){if(this.connected){this.connected=!1,this.emitter.emit("disconnect",t);var e=this;return new Promise(function(t){setTimeout(function(){e.other().connected=!1,e.other().emitter.emit("disconnect"),t()},1)})}throw new Error("Connection already finished")},send:function(t){if(!this.connected)throw new Error("Connection should be started before sending a message");var e=this;setTimeout(function(){e.other().emitter.emit("message",t)},e.pair.delay)}},i.prototype={},t.exports=i},function(t,e){function n(t){function e(){r&&(i.title=r,r=!1)}function n(){i.hidden&&!r?(r=i.title,i.title="* "+i.title):e(),i.hidden&&(c=setTimeout(n,1e3))}function o(){!i.hidden&&c&&(c=clearTimeout(c),e())}var i=document,r=!1,s=[],c=!1;return i&&void 0!==i.hidden&&(s.push(t.sync.on("error",function(t){"timeout"===t.type||c||n()})),s.push(t.log.on("add",function(t){"logux/undo"===t.type&&t.reason&&!c&&n()})),document.addEventListener("visibilitychange",o,!1),s.push(function(){document.removeEventListener("visibilitychange",o,!1)})),function(){for(var t=0;t<s.length;t++)s[t]()}}t.exports=n},function(t,e){function n(t){return void 0===t&&(t=window.event),t&&(t.returnValue="unsynced"),"unsynced"}function o(t){function e(){"disconnected"===t.state?o=!0:"synchronized"===t.state&&(o=!1,i=!1),"follower"!==t.role&&i&&o?window.addEventListener("beforeunload",n):window.removeEventListener("beforeunload",n)}var o="disconnected"===t.state,i=!1,r=[];return r.push(t.on("role",e)),r.push(t.on("state",e)),e(),r.push(t.log.on("add",function(t,n){o&&n.sync&&n.added&&(i=!0,e())})),function(){for(var t=0;t<r.length;t++)r[t]()}}t.exports=o},function(t,e){function n(t,e){function n(){t.connected&&d!==i?A.href=d=i:!t.connected&&r&&d!==r&&d!==s&&(A.href=d=r)}function o(){s&&d!==s&&(A.href=d=s)}var i=e.normal,r=e.offline,s=e.error,c=[],a=document,A=!1,d=!1;return a&&(A=a.querySelector('link[rel~="icon"]'),void 0===i&&(i=A?A.href:""),A||(A=a.createElement("link"),A.rel="icon",A.href="",a.head.appendChild(A)),c.push(t.on("state",n)),n(),c.push(t.log.on("add",function(t){"logux/undo"===t.type&&t.reason&&o()})),c.push(t.sync.on("error",function(t){"timeout"!==t.type&&o()}))),function(){for(var t=0;t<c.length;t++)c[t]()}}t.exports=n},function(t,e,n){function o(t,e){for(var n in e)t.style[n]=e[n]}function i(t,e){var n=t.style;"middle-center"===e||"center-middle"===e?(n.top="50%",n.left="50%",n.transform="translate(-50%, -50%)"):e.split("-").forEach(function(t){"middle"===t?(n.top="50%",n.transform="translateY(-50%)"):"center"===t?(n.left="50%",n.transform="translateX(-50%)"):n[t]="0"})}function r(t,e){function n(t,e){h.innerHTML=e,o(u,t),u.style.display="block"}function r(){u.style.display="none"}var a=e.messages,A=e.position||"bottom-right",d=e.styles,u=document.createElement("div"),h=document.createElement("span");u.setAttribute("role","alert"),o(u,c),o(u,d.base),o(h,d.text),i(u,A);var g=s(t,function(t){"sendingAfterWait"===t||"connectingAfterWait"===t?n(d.sending,a.sending):"synchronizedAfterWait"===t?n(d.synchronized,a.synchronized):"synchronized"===t?r():"disconnected"===t?n(d.disconnected,a.disconnected):"wait"===t?n(d.wait,a.wait):"protocolError"===t?n(d.protocolError,a.protocolError):"syncError"===t?n(d.error,a.syncError):"error"===t?n(d.error,a.error):"denied"===t&&n(d.error,a.denied)},e);return u.appendChild(h),document.body.appendChild(u),function(){g(),document.body.removeChild(u)}}var s=n(29),c={boxSizing:"content-box",visibility:"visible",textIndent:"0",textTransform:"none",wordSpacing:"normal",letterSpacing:"normal",fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",lineHeight:"auto"};t.exports=r},function(t,e){function n(t,e,n){var o=t.on?t:t.sync,i="disconnected"===o.state,r=!1;n||(n={}),void 0===n.duration&&(n.duration=3e3);var s,c=[];c.push(o.on("state",function(){clearTimeout(s),"disconnected"===o.state?(i=!0,e(r?"wait":"disconnected")):"synchronized"===o.state?(i=!1,r?(r=!1,e("synchronizedAfterWait"),s=setTimeout(function(){e("synchronized")},n.duration)):e("synchronized")):"connecting"===o.state?s=setTimeout(function(){e("connecting"+(r?"AfterWait":""))},100):e(t.state+(r?"AfterWait":""))})),c.push(t.sync.on("error",function(t){"wrong-protocol"===t.type||"wrong-subprotocol"===t.type?e("protocolError"):"timeout"!==t.type&&e("syncError",{error:t})})),c.push(t.sync.on("clientError",function(t){e("syncError",{error:t})}));var a=t.on?t:t.log;return c.push(a.on("add",function(t,n){"logux/undo"===t.type&&t.reason?"denied"===t.reason?e("denied",{action:t,meta:n}):e("error",{action:t,meta:n}):i&&n.sync&&n.added&&(r=!0,e("wait"))})),function(){for(var t=0;t<c.length;t++)c[t]()}}t.exports=n},function(t,e,n){function o(t){return"%c"+t+"%c"}function i(t,e,n,o){e="%cLogux:%c "+e,t||(e=e.replace(/%c/g,""));var i=[e];if(t)for(var r=e.match(/%c[^%]+%c/g),s=0;s<r.length;s++)0===s?i.push("color: #ffa200"):i.push("font-weight: bold"),i.push("");return n&&o&&(i.push(n),i.push(o)),i}function r(t,e){function n(t,e,n){console.log.apply(console,i(a,t,e,n))}function r(t){var e="error: "+t.description;t.received&&(e="server sent "+e),console.error.apply(console,i(a,e))}e||(e={});var c=t.sync,a=!1!==e.color&&s(),A=[],d=!1;return!1!==e.state&&A.push(t.on("state",function(){var e="";"connecting"===t.state&&c.connection.url?e=". "+o(c.localNodeId)+" is connecting to "+o(c.connection.url)+".":t.connected&&!d&&c.remoteNodeId?(e=". Client was connected to "+o(c.remoteNodeId)+".",d=!0):t.connected||(d=!1),n("state was changed to "+o(t.state)+e)})),!1!==e.role&&A.push(t.on("role",function(){n("tab role was changed to "+o(t.role))})),!1!==e.error&&(A.push(c.on("error",function(t){r(t)})),A.push(c.on("clientError",function(t){r(t)}))),!1!==e.add&&A.push(t.on("add",function(e,i){if(!i.tab||i.tab===t.id){var r="action "+o(e.type)+" was added";i.id[1]!==c.localNodeId&&(r+=" by "+o(i.id[1])),n(r,e,i)}})),!1!==e.clean&&A.push(t.on("clean",function(e,i){if(!i.tab||i.tab===t.id){n("action "+o(e.type)+" was cleaned",e,i)}})),function(){for(var t=0;t<A.length;t++)A[t]()}}var s=n(31);t.exports=r},function(t,e){function n(){if("undefined"==typeof window||"undefined"==typeof document)return!1;var t=navigator.userAgent.toLowerCase().indexOf("edge")>-1,e="WebkitAppearance"in document.documentElement.style,n=window.console&&(window.console.firebug||window.console.exception&&window.console.table)&&!0,o=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31;return e&&!t||n||o||!1}t.exports=n},function(t,e){t.exports={synchronized:"Your data has been saved",disconnected:"No Internet connection",wait:"No Internet connection<br>Your data has not been saved",sending:"Data saving",syncError:"Server error<br>Your data has not been saved",error:"Server error<br>You changes was reverted",denied:"You have no access<br>You changes was reverted",protocolError:"Saving is not working<br>Refresh the page"}},function(t,e,n){var o=n(34),i=n(35),r=n(36),s=n(37);t.exports={base:{position:"fixed",width:"15.4em",height:"4em",lineHeight:"1.4",margin:"1.5em",paddingLeft:"4.2em",opacity:"0.8",borderRadius:"0.4em",color:"#fff",fontFamily:"Helvetica Neue, sans-serif",zIndex:"999",backgroundPosition:"1.2em center",backgroundRepeat:"no-repeat",backgroundSize:"1.8em"},text:{display:"table-cell",verticalAlign:"middle",height:"4em"},synchronized:{backgroundColor:"#000",backgroundImage:"url("+i+")"},disconnected:{backgroundColor:"#000",backgroundImage:"url("+r+")"},wait:{backgroundColor:"#000",backgroundImage:"url("+r+")"},sending:{backgroundColor:"#000",backgroundImage:"url("+o+")"},error:{backgroundColor:"#F42A2A",backgroundImage:"url("+s+")"},protocolError:{backgroundColor:"#000",backgroundImage:"url("+o+")"}}},function(t,e){t.exports="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIxNSAxNCAyMCAyMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTcuOTMyIDMyLjA2OGwxLjQxNC0xLjQxNEE3Ljk3NSA3Ljk3NSAwIDAgMCAyNSAzM2M0LjQxMSAwIDgtMy41ODkgOC04aDJjMCA1LjUxNC00LjQ4NiAxMC0xMCAxMGE5Ljk2OSA5Ljk2OSAwIDAgMS03LjA2OC0yLjkzMnpNMTUgMjVjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGE5Ljk2OSA5Ljk2OSAwIDAgMSA3LjA2OCAyLjkzMmwtMS40MTQgMS40MTRBNy45NzUgNy45NzUgMCAwIDAgMjUgMTdjLTQuNDExIDAtOCAzLjU4OS04IDhoLTJ6bTE4LjUtOC41TDI5IDIxbDYgMi0xLjUtNi41ek0yMSAyOWwtNC41IDQuNUwxNSAyN2w2IDJ6IiBmaWxsPSIjRkZGIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4="},function(t,e){t.exports="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIxMyAxNyAyMyAxNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InNxdWFyZSIgZmlsbD0ibm9uZSIgZD0iTTE0LjUgMjUuNWw2LjY3IDYuNjdMMzQuNSAxOC41Ii8+PC9zdmc+"},function(t,e){t.exports="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIxNSAxNCAyMCAyMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTcuOTMyIDMyLjA2OGwxLjQxNC0xLjQxNEE3Ljk3NSA3Ljk3NSAwIDAgMCAyNSAzM2M0LjQxMSAwIDgtMy41ODkgOC04aDJjMCA1LjUxNC00LjQ4NiAxMC0xMCAxMGE5Ljk2OSA5Ljk2OSAwIDAgMS03LjA2OC0yLjkzMnpNMTUgMjVjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGE5Ljk2OSA5Ljk2OSAwIDAgMSA3LjA2OCAyLjkzMmwtMS40MTQgMS40MTRBNy45NzUgNy45NzUgMCAwIDAgMjUgMTdjLTQuNDExIDAtOCAzLjU4OS04IDhoLTJ6bTE4LjUtOC41TDI5IDIxbDYgMi0xLjUtNi41ek0yMSAyOWwtNC41IDQuNUwxNSAyN2w2IDJ6bTMtMTBoMnY0bC0uNSA0aC0xbC0uNS00di00em0xIDExYTEgMSAwIDEgMSAwLTIgMSAxIDAgMCAxIDAgMnoiIGZpbGw9IiNGRkYiIGZpbGwtcnVsZT0iZXZlbm9kZCIvPjwvc3ZnPg=="},function(t,e){t.exports="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIxMyAxNCAyNCAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMjAgMjloLTFhNCA0IDAgMCAxLS45OTgtNy44NzQgNSA1IDAgMCAxIDkuMzMzLTIuNjIxIDMgMyAwIDAgMSA0LjQ5IDMuNTFBMy41IDMuNSAwIDAgMSAzMS40OTkgMjlIMzB2MmgxLjVhNS41IDUuNSAwIDAgMCAyLjQ4NC0xMC40MDggNSA1IDAgMCAwLTUuOTg1LTQuNDkyIDcuMDAzIDcuMDAzIDAgMCAwLTExLjg4NiAzLjY0QTYgNiAwIDAgMCAxOSAzMWgxdi0yem02LTYuNTAybC01IDguNDUxIDQgLjAyNS0yIDYuNTQ2IDYtOC40ODMtNC0uMDExIDEtNi41Mjh6IiBmaWxsPSIjRkZGIi8+PC9zdmc+"},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAMAAAAOusbgAAABzlBMVEUAAAAAAAAAgAAAmQAAgAAAkgAAiwAAgAAAiQAAgAAAiAAAhwAAgAAAhgAAgAAAhgAAgAAAhQAAgAAAhQAAgAAAhAAAgAAAhAAAgAAAhAAAgAAAgwAAgAAAgwAAgAAAgwAAgAAAgwAAgAAAgwAAgAAAggAAgAAAgAAAggAAgAAAggAAgAAAgAAAggAAgAAAggAAgAAAggAAgAAAgQAAgQAAgAAAgQAAgAAAgQAAgQAAgAAAgAAAgQAAgAAAgQAAgAAAgQAAgAAAgAAAgQAAgAAAgQAAgQAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgACYS+jrAAAAmXRSTlMAAQQFBgcLDA0ODxESExQVFhcYGRobHB0eHyAhIiMkJSYnKCksLS4wMTI3ODo7PD0+P0xNT1BTVFVXWFpbXl9gYWJmaWprbW6AgYKDhYaHiImKi4yNjo+RkpSXmZqbnJ2foqqtrq+5u7y+xMXGx8jJysvQ0dLT1dbY2drc3d7g4eLj5OXm5+jq6+zt7u/w8fX29/j5+vv8/f5OSOWKAAACyklEQVR4Ae3aA7okSxQE4Bjbtm3bc23btm2b1f1ex25nA1nO813Vv4BCGoGdIBAIBI49/ZVS1dQ5uGAYC4OdTZUpv54eg7TTHwuGqDBZ/vsSxNxJ7qeFvsTbEHA8po22WqKPQ6+LOSt0ZL3gAvS5krNGx0Jlt6DH/pQwXQnnHIIGb8bo2uS3XfDpSh09qb0EX94u0KOlj/BuT0qEnkVy9sKjM230pfkUPLnST5+GbsCDexP0bfohXHu1TA2WX8Cl+4vUYvkRXLk2RU1mbsKFk/3UZvA0HNvXRo2a98KpXGqVCYdeR6hV5B0cuThPzRauwIFdddSuBg58pYBPsHVoggKmDsu3aLUs2LjxH0WEr8FaCYUUwtIFg0JCl2Alj2JyYOHEKsWsHoO5GAqKgrk2CmqGqTsUdQtmkikqHmb6KaoHJs5R2DmofaOwr1ArpbBiqI1Q2BCUjlPcUag8o7gnUPlFcd+hkkpxSVCporgKqDRRXD1UuiiuAyrDFDcElXmKm4WKQXHrG//ijS/qjWxcG9adNmwA2bAhM4XiEqHyk+K+QeUpxT2GylGKO4qN6chDG7W8LdqoBf0XqJ2lrMgZmOilqG6YSaKoOJi5uVEbc7RSUCPMRVPQH5g7vkoxK8dgIZdismHlvEEh6+dgqYhC8mHtWpgiQldgI5si0mHn4DgFTB6Crc8U8AEO1FK7ajhxYY6aLVzeoCu+t1CRb9lpcGpvMzVq2APHTvRSm4FTcOHqJDWZvAJX7ukKJzyESy+XqMHSc7h2d5y+TT2AB1f66NPgdXhyqpm+NJyAR7tj/5ePVam9madHS+/hy6UaelJ9AX69GaVrE9+gwaGsMF0JZRyAHpfdBEKNshvQ51SK4wjseeh1LKqZtpr+HoWAmwk9tNAddwNiTn4sGDQJdl+AtKNPfiRXNLQPzhvG/GB7fUXS9ydHsAMEAoHAP3w+T5jYJRnoAAAAAElFTkSuQmCC"},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAMAAAAOusbgAAABzlBMVEUAAAAAAACAgICZmZmAgICSkpKLi4uAgICJiYmAgICIiIiHh4eAgICGhoaAgICGhoaAgICFhYWAgICFhYWAgICEhISAgICEhISAgICEhISAgICDg4OAgICDg4OAgICDg4OAgICDg4OAgICDg4OAgICCgoKAgICAgICCgoKAgICCgoKAgICAgICCgoKAgICCgoKAgICCgoKAgICBgYGBgYGAgICBgYGAgICBgYGBgYGAgICAgICBgYGAgICBgYGAgICBgYGAgICAgICBgYGAgICBgYGBgYGAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICq+RHaAAAAmXRSTlMAAQQFBgcLDA0ODxESExQVFhcYGRobHB0eHyAhIiMkJSYnKCksLS4wMTI3ODo7PD0+P0xNT1BTVFVXWFpbXl9gYWJmaWprbW6AgYKDhYaHiImKi4yNjo+RkpSXmZqbnJ2foqqtrq+5u7y+xMXGx8jJysvQ0dLT1dbY2drc3d7g4eLj5OXm5+jq6+zt7u/w8fX29/j5+vv8/f5OSOWKAAACyklEQVR4Ae3aA7okSxQE4Bjbtm3bc23btm2b1f1ex25nA1nO813Vv4BCGoGdIBAIBI49/ZVS1dQ5uGAYC4OdTZUpv54eg7TTHwuGqDBZ/vsSxNxJ7qeFvsTbEHA8po22WqKPQ6+LOSt0ZL3gAvS5krNGx0Jlt6DH/pQwXQnnHIIGb8bo2uS3XfDpSh09qb0EX94u0KOlj/BuT0qEnkVy9sKjM230pfkUPLnST5+GbsCDexP0bfohXHu1TA2WX8Cl+4vUYvkRXLk2RU1mbsKFk/3UZvA0HNvXRo2a98KpXGqVCYdeR6hV5B0cuThPzRauwIFdddSuBg58pYBPsHVoggKmDsu3aLUs2LjxH0WEr8FaCYUUwtIFg0JCl2Alj2JyYOHEKsWsHoO5GAqKgrk2CmqGqTsUdQtmkikqHmb6KaoHJs5R2DmofaOwr1ArpbBiqI1Q2BCUjlPcUag8o7gnUPlFcd+hkkpxSVCporgKqDRRXD1UuiiuAyrDFDcElXmKm4WKQXHrG//ijS/qjWxcG9adNmwA2bAhM4XiEqHyk+K+QeUpxT2GylGKO4qN6chDG7W8LdqoBf0XqJ2lrMgZmOilqG6YSaKoOJi5uVEbc7RSUCPMRVPQH5g7vkoxK8dgIZdismHlvEEh6+dgqYhC8mHtWpgiQldgI5si0mHn4DgFTB6Crc8U8AEO1FK7ajhxYY6aLVzeoCu+t1CRb9lpcGpvMzVq2APHTvRSm4FTcOHqJDWZvAJX7ukKJzyESy+XqMHSc7h2d5y+TT2AB1f66NPgdXhyqpm+NJyAR7tj/5ePVam9madHS+/hy6UaelJ9AX69GaVrE9+gwaGsMF0JZRyAHpfdBEKNshvQ51SK4wjseeh1LKqZtpr+HoWAmwk9tNAddwNiTn4sGDQJdl+AtKNPfiRXNLQPzhvG/GB7fUXS9ydHsAMEAoHAP3w+T5jYJRnoAAAAAElFTkSuQmCC"},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAMAAAAOusbgAAABzlBMVEUAAAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AADGIKqbAAAAmXRSTlMAAQQFBgcLDA0ODxESExQVFhcYGRobHB0eHyAhIiMkJSYnKCksLS4wMTI3ODo7PD0+P0xNT1BTVFVXWFpbXl9gYWJmaWprbW6AgYKDhYaHiImKi4yNjo+RkpSXmZqbnJ2foqqtrq+5u7y+xMXGx8jJysvQ0dLT1dbY2drc3d7g4eLj5OXm5+jq6+zt7u/w8fX29/j5+vv8/f5OSOWKAAACyklEQVR4Ae3aA7okSxQE4Bjbtm3bc23btm2b1f1ex25nA1nO813Vv4BCGoGdIBAIBI49/ZVS1dQ5uGAYC4OdTZUpv54eg7TTHwuGqDBZ/vsSxNxJ7qeFvsTbEHA8po22WqKPQ6+LOSt0ZL3gAvS5krNGx0Jlt6DH/pQwXQnnHIIGb8bo2uS3XfDpSh09qb0EX94u0KOlj/BuT0qEnkVy9sKjM230pfkUPLnST5+GbsCDexP0bfohXHu1TA2WX8Cl+4vUYvkRXLk2RU1mbsKFk/3UZvA0HNvXRo2a98KpXGqVCYdeR6hV5B0cuThPzRauwIFdddSuBg58pYBPsHVoggKmDsu3aLUs2LjxH0WEr8FaCYUUwtIFg0JCl2Alj2JyYOHEKsWsHoO5GAqKgrk2CmqGqTsUdQtmkikqHmb6KaoHJs5R2DmofaOwr1ArpbBiqI1Q2BCUjlPcUag8o7gnUPlFcd+hkkpxSVCporgKqDRRXD1UuiiuAyrDFDcElXmKm4WKQXHrG//ijS/qjWxcG9adNmwA2bAhM4XiEqHyk+K+QeUpxT2GylGKO4qN6chDG7W8LdqoBf0XqJ2lrMgZmOilqG6YSaKoOJi5uVEbc7RSUCPMRVPQH5g7vkoxK8dgIZdismHlvEEh6+dgqYhC8mHtWpgiQldgI5si0mHn4DgFTB6Crc8U8AEO1FK7ajhxYY6aLVzeoCu+t1CRb9lpcGpvMzVq2APHTvRSm4FTcOHqJDWZvAJX7ukKJzyESy+XqMHSc7h2d5y+TT2AB1f66NPgdXhyqpm+NJyAR7tj/5ePVam9madHS+/hy6UaelJ9AX69GaVrE9+gwaGsMF0JZRyAHpfdBEKNshvQ51SK4wjseeh1LKqZtpr+HoWAmwk9tNAddwNiTn4sGDQJdl+AtKNPfiRXNLQPzhvG/GB7fUXS9ydHsAMEAoHAP3w+T5jYJRnoAAAAAElFTkSuQmCC"}]);</script></body>
</html>
